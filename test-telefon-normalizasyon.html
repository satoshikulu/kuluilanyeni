<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telefon Normalizasyon Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-case { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
        .success { background-color: #d4edda; }
        .error { background-color: #f8d7da; }
        button { padding: 10px 20px; margin: 5px; }
    </style>
</head>
<body>
    <h1>üì± Telefon Normalizasyon Test</h1>
    
    <div class="test-case">
        <h3>Test Senaryolarƒ±</h3>
        <button onclick="testNormalization()">Normalizasyon Fonksiyonunu Test Et</button>
        <button onclick="testFCMNotification()">FCM Bildirimi Test Et</button>
        <div id="results"></div>
    </div>

    <script>
        // Telefon numarasƒ±nƒ± normalize et (firebaseAPI.ts ile aynƒ±)
        function normalizePhone(phone) {
            return phone.replace(/\D/g, '').slice(-10);
        }

        function testNormalization() {
            const testCases = [
                { input: '5453526056', expected: '5453526056' },
                { input: '0545 352 60 56', expected: '5453526056' },
                { input: '+90 545 352 60 56', expected: '5453526056' },
                { input: '+905453526056', expected: '5453526056' },
                { input: '(0545) 352-60-56', expected: '5453526056' },
                { input: '90 545 352 60 56', expected: '5453526056' }
            ];

            let results = '<h4>Normalizasyon Test Sonu√ßlarƒ±:</h4>';
            
            testCases.forEach((testCase, index) => {
                const result = normalizePhone(testCase.input);
                const isSuccess = result === testCase.expected;
                
                results += `
                    <div class="test-case ${isSuccess ? 'success' : 'error'}">
                        <strong>Test ${index + 1}:</strong><br>
                        Giri≈ü: "${testCase.input}"<br>
                        Beklenen: "${testCase.expected}"<br>
                        Sonu√ß: "${result}"<br>
                        Durum: ${isSuccess ? '‚úÖ BA≈ûARILI' : '‚ùå BA≈ûARISIZ'}
                    </div>
                `;
            });

            document.getElementById('results').innerHTML = results;
        }

        async function testFCMNotification() {
            const testPhone = '0545 352 60 56'; // Ham format
            const normalizedPhone = normalizePhone(testPhone);
            
            console.log('üîç Test telefonu:', testPhone, '‚û° normalize:', normalizedPhone);
            
            try {
                // Supabase Edge Function'ƒ± √ßaƒüƒ±r
                const response = await fetch('/functions/v1/send-fcm-notification', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer YOUR_SUPABASE_ANON_KEY'
                    },
                    body: JSON.stringify({
                        phone: normalizedPhone, // Normalize edilmi≈ü telefon g√∂nder
                        title: 'üß™ Test Bildirimi',
                        body: 'Bu bir test bildirimidir.',
                        data: {
                            type: 'test',
                            test_id: 'normalization_test'
                        }
                    })
                });

                const result = await response.json();
                
                let resultHtml = `
                    <div class="test-case ${result.success ? 'success' : 'error'}">
                        <h4>FCM Test Sonucu:</h4>
                        <strong>Telefon:</strong> ${testPhone} ‚û° ${normalizedPhone}<br>
                        <strong>Durum:</strong> ${result.success ? '‚úÖ BA≈ûARILI' : '‚ùå BA≈ûARISIZ'}<br>
                        <strong>Mesaj:</strong> ${result.message || result.error}<br>
                        <strong>Detay:</strong> <pre>${JSON.stringify(result, null, 2)}</pre>
                    </div>
                `;
                
                document.getElementById('results').innerHTML = resultHtml;
                
            } catch (error) {
                document.getElementById('results').innerHTML = `
                    <div class="test-case error">
                        <h4>FCM Test Hatasƒ±:</h4>
                        <strong>Hata:</strong> ${error.message}<br>
                        <strong>Not:</strong> Bu test ger√ßek Supabase baƒülantƒ±sƒ± gerektirir.
                    </div>
                `;
            }
        }

        // Sayfa y√ºklendiƒüinde normalizasyon testini √ßalƒ±≈ütƒ±r
        window.onload = function() {
            testNormalization();
        };
    </script>
</body>
</html>